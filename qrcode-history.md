# 小程序扫普通二维码调起小程序 码地址传为历史地址

## 问题：
用户实际扫码A二维码，小程序onload中传递q参数为B二维码地址，该二维码地址为用户历史使用二维码地址。


## 原因：
微信侧扫码启动参数错乱。

    用户使用微信“扫一扫”扫描A二维码，微信通过系统事件启动小程序，用户使用完之后，将小程序退到后台，一段时间后小程序被系统回收。
    用户再次扫描B二维码，微信仍然通过系统事件启动小程序，但是实际上，系统先发出A二维码的启动事件，再发出B二维码的启动事件，导致小程序启动参数错乱。理论上，用户第二次扫码的时候，系统不应该连续发出两次事件。

## 解决方案：
    目前扫码启动小程序的场景，微信会将原始URL，通过参数的方式传给小程序，key为"q"。
    后台改动上线后，会多出一个key为"scancode_time"的UNIX时间戳参数，大致可以认为是用户扫码的时间。
    用户扫码时间和当前onlaod时间在30s以内，可以认为非上一次扫码地址。

## 风险：
    1.用户客户端时间被调整过，容易导致误判断，建议以服务端时间为准.
    2.30s是否足以覆盖所有案例？ 个人认为30s有风险。用户从扫码到onload执行，这其中遇到弱网环境是否超过了30s时间？
        解决方案：和微信侧确定该时间中，方案待定



